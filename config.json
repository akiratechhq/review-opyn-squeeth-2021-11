{
    "client_name": "Opyn",
    "commit_hash": "474413cbba52708c953a23a500acc4194735c87b",
    "date": "December 2021",
    "date_interval": "November 29 to December 10, 2021",
    "issues": [
        {
            "active_lock_reason": null,
            "assignee": null,
            "assignees": [],
            "author_association": "CONTRIBUTOR",
            "body": "**Description**\r\n\r\nEdit: issue fixed in [opynfinance/squeeth-monorepo#630](https://github.com/opynfinance/squeeth-monorepo/pull/630).\r\n\r\nThe `ShortPowerPerp` contract is used to generate an NFT, which represents the user's ownership of a vault within the Squeeth platform:\r\n\r\nhttps://github.com/akiratechhq/review-opyn-squeeth-2021-11/blob/334d87dd005336f60b0e9a767f16910b076e404e/code/packages/hardhat/contracts/core/ShortPowerPerp.sol#L38-L46\r\n\r\nThe issue is that the function uses OpenZeppelin's `ERC721._mint` function instead of `_safeMint`. The difference between these two functions is that `_safeMint` ensures that the `onERC721Received` function is called on the destination address to handle the receipt of the NFT (for non-contract addresses this is a no-op):\r\n\r\n```solidity\r\n    /**\r\n     * @dev Same as {xref-ERC721-_safeMint-address-uint256-}[`_safeMint`], with an additional `data` parameter which is\r\n     * forwarded in {IERC721Receiver-onERC721Received} to contract recipients.\r\n     */\r\n    function _safeMint(address to, uint256 tokenId, bytes memory _data) internal virtual {\r\n        _mint(to, tokenId);\r\n        require(_checkOnERC721Received(address(0), to, tokenId, _data), \"ERC721: transfer to non ERC721Receiver implementer\");\r\n    }\r\n```\r\n\r\nWhen transferring Uniswap V3 LP tokens, since they implement the EIP-721 standard, the `safeTransferFrom` function should be called instead (the `NonfungiblePositionManager` contract extends OpenZeppeling's `EIP721` contract):\r\n\r\nhttps://github.com/akiratechhq/review-opyn-squeeth-2021-11/blob/334d87dd005336f60b0e9a767f16910b076e404e/code/packages/hardhat/contracts/core/Controller.sol#L800\r\n\r\nA user can deposit Uniswap V3 LP positions as collateral in a vault by calling `Controller.depositUniPositionToken`:\r\n\r\nhttps://github.com/akiratechhq/review-opyn-squeeth-2021-11/blob/334d87dd005336f60b0e9a767f16910b076e404e/code/packages/hardhat/contracts/core/Controller.sol#L344\r\n\r\nAccording to the [EIP-721 specification](https://eips.ethereum.org/EIPS/eip-721#specification) a contract that receives NFT tokens should implement the `onERC721Received` function:\r\n\r\n```solidity\r\n/// @dev Note: the ERC-165 identifier for this interface is 0x150b7a02.\r\ninterface ERC721TokenReceiver {\r\n    /// @notice Handle the receipt of an NFT\r\n    /// @dev The ERC721 smart contract calls this function on the recipient\r\n    ///  after a `transfer`. This function MAY throw to revert and reject the\r\n    ///  transfer. Return of other than the magic value MUST result in the\r\n    ///  transaction being reverted.\r\n    ///  Note: the contract address is always the message sender.\r\n    /// @param _operator The address which called `safeTransferFrom` function\r\n    /// @param _from The address which previously owned the token\r\n    /// @param _tokenId The NFT identifier which is being transferred\r\n    /// @param _data Additional data with no specified format\r\n    /// @return `bytes4(keccak256(\"onERC721Received(address,address,uint256,bytes)\"))`\r\n    ///  unless throwing\r\n    function onERC721Received(address _operator, address _from, uint256 _tokenId, bytes _data) external returns(bytes4);\r\n}\r\n```\r\n\r\n**References**\r\n\r\n[EIP-721 specification](https://eips.ethereum.org/EIPS/eip-721#specification)\r\n",
            "closed_at": "2021-12-10T08:28:29Z",
            "comments": 1,
            "comments_url": "https://api.github.com/repos/akiratechhq/review-opyn-squeeth-2021-11/issues/1/comments",
            "created_at": "2021-12-09T11:49:58Z",
            "events_url": "https://api.github.com/repos/akiratechhq/review-opyn-squeeth-2021-11/issues/1/events",
            "html_url": "https://github.com/akiratechhq/review-opyn-squeeth-2021-11/issues/1",
            "id": 1075483191,
            "labels": [
                {
                    "color": "667788",
                    "default": false,
                    "description": null,
                    "id": 3626262105,
                    "name": "Report",
                    "node_id": "LA_kwDOGc23m87YJF5Z",
                    "url": "https://api.github.com/repos/akiratechhq/review-opyn-squeeth-2021-11/labels/Report"
                },
                {
                    "color": "ff3b30",
                    "default": false,
                    "description": null,
                    "id": 3626262286,
                    "name": "Major",
                    "node_id": "LA_kwDOGc23m87YJF8O",
                    "url": "https://api.github.com/repos/akiratechhq/review-opyn-squeeth-2021-11/labels/Major"
                }
            ],
            "labels_url": "https://api.github.com/repos/akiratechhq/review-opyn-squeeth-2021-11/issues/1/labels{/name}",
            "locked": false,
            "milestone": null,
            "node_id": "I_kwDOGc23m85AGpI3",
            "number": 1,
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/akiratechhq/review-opyn-squeeth-2021-11/issues/1/reactions"
            },
            "repository_url": "https://api.github.com/repos/akiratechhq/review-opyn-squeeth-2021-11",
            "state": "closed",
            "timeline_url": "https://api.github.com/repos/akiratechhq/review-opyn-squeeth-2021-11/issues/1/timeline",
            "title": "EIP-721 standard is not implemented correctly; can lead to loss of funds for users;",
            "updated_at": "2021-12-10T08:28:29Z",
            "url": "https://api.github.com/repos/akiratechhq/review-opyn-squeeth-2021-11/issues/1",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/342638?v=4",
                "events_url": "https://api.github.com/users/andreiashu/events{/privacy}",
                "followers_url": "https://api.github.com/users/andreiashu/followers",
                "following_url": "https://api.github.com/users/andreiashu/following{/other_user}",
                "gists_url": "https://api.github.com/users/andreiashu/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/andreiashu",
                "id": 342638,
                "login": "andreiashu",
                "node_id": "MDQ6VXNlcjM0MjYzOA==",
                "organizations_url": "https://api.github.com/users/andreiashu/orgs",
                "received_events_url": "https://api.github.com/users/andreiashu/received_events",
                "repos_url": "https://api.github.com/users/andreiashu/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/andreiashu/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/andreiashu/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/andreiashu"
            }
        }
    ],
    "person_days": "15",
    "project_name": "Opyn Squeeth",
    "review_period": "2 weeks",
    "source_repository": "git@github.com:opynfinance/squeeth-monorepo.git",
    "template": "./Readme.md.mustache"
}